<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SSLC Referral System</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: linear-gradient(to bottom, #0a0f2c, #050a1f);
  color: white;
  padding: 20px;
}

.card {
  background: #111a3a;
  padding: 20px;
  border-radius: 15px;
  margin-bottom: 20px;
  box-shadow: 0 0 10px black;
}

input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 10px;
  border: none;
}

button {
  background: #FFD700;
  color: black;
  padding: 12px;
  border: none;
  border-radius: 10px;
  width: 100%;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
}

.gold { color: gold; }
.center { text-align: center; }
.hidden { display: none; }

</style>
</head>
<body>

<h2 class="center">ðŸ”¥ SSLC 2026 Crash Course</h2>

<!-- REGISTRATION SECTION -->
<div class="card" id="registerSection">
  <h3>Enter Details</h3>
  <input type="text" id="name" placeholder="Your Name">
  <input type="tel" id="phone" placeholder="Phone Number">
  <button onclick="googleLogin()">Continue with Google</button>
</div>

<!-- DASHBOARD -->
<div class="card hidden" id="dashboard">
  <h3>Welcome <span id="studentName"></span> ðŸ‘‹</h3>

  <p>Your Referral Code:</p>
  <h2 class="gold" id="myCode"></h2>

  <p>Referral Streak:</p>
  <h2 id="refCount">0/10</h2>

  <div id="unlockStatus"></div>

  <button onclick="shareWhatsApp()">Share on WhatsApp</button>
  <button onclick="logout()">Logout</button>
</div>

<script>

/* ðŸ”¥ FIREBASE CONFIG */
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyC0Jf7YY9swFu_JAY-TeDfvlMCz1Iw23MU",
  authDomain: "leadgen-da6b8.firebaseapp.com",
  projectId: "leadgen-da6b8",
  storageBucket: "leadgen-da6b8.firebasestorage.app",
  messagingSenderId: "462081996744",
  appId: "1:462081996744:web:177127efe807c0f6b332fd",
  measurementId: "G-FXZFGYM89Y"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* GET REFERRAL FROM URL */
const urlParams = new URLSearchParams(window.location.search);
const refFromURL = urlParams.get('ref');

/* GOOGLE LOGIN */
async function googleLogin() {

  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;

  if(!name || !phone){
    alert("Please enter Name & Phone Number");
    return;
  }

  const provider = new firebase.auth.GoogleAuthProvider();

  try{
    const result = await auth.signInWithPopup(provider);
    const user = result.user;

    const docRef = db.collection("users").doc(user.uid);
    const docSnap = await docRef.get();

    if(!docSnap.exists){

      const referralCode = "SSLC" + Math.floor(1000 + Math.random() * 9000);

      await docRef.set({
        name: name,
        phone: phone,
        email: user.email,
        referralCode: referralCode,
        referredBy: refFromURL || null,
        referralCount: 0,
        unlocked: false,
        joinedDate: new Date()
      });

      /* Increase referral count */
      if(refFromURL){
        const snapshot = await db.collection("users")
          .where("referralCode","==",refFromURL).get();

        snapshot.forEach(async (doc)=>{
          const data = doc.data();
          let newCount = data.referralCount + 1;

          await db.collection("users").doc(doc.id).update({
            referralCount: newCount,
            unlocked: newCount >= 10
          });
        });
      }

    }

  }catch(error){
    alert(error.message);
  }
}

/* AUTH STATE */
auth.onAuthStateChanged(async (user)=>{
  if(user){

    document.getElementById("registerSection").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");

    const doc = await db.collection("users").doc(user.uid).get();
    const data = doc.data();

    document.getElementById("studentName").innerText = data.name;
    document.getElementById("myCode").innerText = data.referralCode;
    document.getElementById("refCount").innerText =
      data.referralCount + "/10";

    if(data.unlocked){
      document.getElementById("unlockStatus").innerHTML =
        "<h2 class='gold'>ðŸŽ‰ Course Unlocked!</h2>";
    }else{
      document.getElementById("unlockStatus").innerHTML =
        "<p>Refer 10 friends to unlock FREE course.</p>";
    }

  }
});

/* SHARE WHATSAPP */
function shareWhatsApp(){
  const code = document.getElementById("myCode").innerText;
  const link = window.location.origin + "?ref=" + code;

  const message =
   "ðŸ”¥ Join SSLC 2026 Crash Course FREE!\n\n" +
   "Use my referral link:\n" + link;

  const whatsappURL =
   "https://wa.me/?text=" + encodeURIComponent(message);

  window.open(whatsappURL,"_blank");
}

/* LOGOUT */
function logout(){
  auth.signOut();
}

</script>

</body>
</html>
